<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Majority Rules – Admin</title>
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: system-ui, -apple-system, sans-serif;
      margin: 0;
      min-height: 100vh;
      background: #0f0f1a;
      color: #ddd;
      padding: 2rem;
    }
    h1 { color: #a0a0ff; }
    .section { margin: 2rem 0; }
    .section h2 { font-size: 1.1rem; color: #888; margin-bottom: 0.75rem; }
    button {
      background: #2a2a4a;
      color: #eee;
      border: 1px solid #444;
      padding: 0.6rem 1rem;
      margin: 0 0.5rem 0.5rem 0;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover { background: #3a3a5a; }
    button.danger { background: #4a2a2a; border-color: #644; }
    button.danger:hover { background: #5a3a3a; }
    #message { margin-top: 1rem; min-height: 1.5rem; color: #7fdbff; }
    .state { font-family: monospace; font-size: 0.9rem; background: #1a1a2e; padding: 1rem; border-radius: 6px; margin-top: 1rem; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Majority Rules – Admin</h1>
  <p>Control the game from here. Use <strong>TV</strong> on the projector: <a href="/tv" target="_blank">/tv</a></p>

  <div class="section">
    <h2>Game lifecycle</h2>
    <button type="button" id="btn-start">Start game (new round total: 3)</button>
    <button type="button" id="btn-next-phase">Next phase</button>
    <button type="button" id="btn-next-round">Next round</button>
    <button type="button" id="btn-reset" class="danger">Reset game</button>
  </div>

  <p id="message"></p>
  <div class="state" id="state">—</div>

  <script>
    const API_BASE = window.location.origin;
    const messageEl = document.getElementById('message');
    const stateEl = document.getElementById('state');

    function msg(s) {
      messageEl.textContent = s;
    }

    function refreshState() {
      fetch(API_BASE + '/api/state')
        .then(r => r.json())
        .then(data => { stateEl.textContent = JSON.stringify(data, null, 2); })
        .catch(() => { stateEl.textContent = 'Failed to fetch state'; });
    }

    document.getElementById('btn-start').onclick = function() {
      fetch(API_BASE + '/api/admin/start', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ round_total: 3 }),
      })
        .then(r => r.json())
        .then(d => { msg('Started. Phase: LOBBY. Round total: ' + d.round_total); refreshState(); })
        .catch(e => msg('Error: ' + e.message));
    };

    document.getElementById('btn-next-phase').onclick = function() {
      fetch(API_BASE + '/api/admin/next_phase', { method: 'POST' })
        .then(r => r.json())
        .then(d => { msg('Phase: ' + d.phase); refreshState(); })
        .catch(e => msg('Error: ' + e.message));
    };

    document.getElementById('btn-next-round').onclick = function() {
      fetch(API_BASE + '/api/admin/next_round', { method: 'POST' })
        .then(r => r.json())
        .then(d => { msg('Round ' + d.round_id + ', prompt set, phase ANSWER'); refreshState(); })
        .catch(e => msg('Error: ' + e.message));
    };

    document.getElementById('btn-reset').onclick = function() {
      if (!confirm('Reset entire game (all players and scores)?')) return;
      fetch(API_BASE + '/api/admin/reset', { method: 'POST' })
        .then(r => r.json())
        .then(() => { msg('Game reset.'); refreshState(); })
        .catch(e => msg('Error: ' + e.message));
    };

    refreshState();
    setInterval(refreshState, 3000);
  </script>
</body>
</html>
